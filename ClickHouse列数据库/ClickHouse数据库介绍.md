## 官方文档地址

https://clickhouse.tech/docs/zh/single/#olapchang-jing-de-guan-jian-te-zheng



## 相关优秀文章

> ### 携程ClickHouse日志分析实践
>
> https://blog.csdn.net/ctrip_tech/article/details/104079164
>
> #### 使用clickhouse来做业务和性能监控
>
> https://joeyxf.com/posts/business-and-api-monitor
>
> #### 趣头条基于ClickHouse玩转每天1000亿数据量
>
> https://dbaplus.cn/news-73-2939-1.html
>
> #### 各个OLAP 引擎详细对比介绍
>
> https://zhuanlan.zhihu.com/p/141145481
>
> 入门
>
> https://www.bbsmax.com/A/xl56rZBm5r/
>
> #### Clickhouse 常见SQL需求案例
>
> https://zhuanlan.zhihu.com/p/40698736



## 特点

与Hadoop、Spark这些巨无霸组件相比，ClickHouse很轻量级，

其特点：列式存储数据库，数据压缩；关系型、支持SQL；

分布式并行计算，把单机性能压榨到极限；高可用；**数据量级在PB级别。**



## 适用场景

日志数据的行为分析，

标签画像的分析，

数据集市层分析。

\1. 用户行为分析系统

行为分析系统的表可以打成一个大的宽表形式，join 的形式相对少一点，可以实现路径分析、漏斗分析、路径转化等功能

\2. BI报表

结合clickhouse的实时查询功能，可以实时的做一些需要及时产出的灵活BI报表需求，包括并成功应用于留存分析、用户增长、广告营销等

\3. 监控系统

视频播放质量、CDN质量，系统服务报错信息等指标，也可以接入ClickHouse，结合Kibana实现监控大盘功能

\4. ABtest

其高效的存储性能以及丰富的数据聚合函数成为实验效果分析的不二选择。离线和实时整合后的用户命中的实验分组对应的行为日志数据最终都导入了clickhouse，用于计算用户对应实验的一些埋点指标数据（主要包括pv、uv）。

业界可以参考：https://www.jianshu.com/p/79d31a72978f（Athena-贝壳流量实验平台设计与实践）

\5. 特征分析

使用Clickhouse针对大数据量的数据进行聚合计算来提取特征



## 业务场景

数据存储后,基本不做修改,比如日志数据

绝大多数请求都是用于读访问

 表很"宽"，即表中包含大量的列

 在处理单个查询时需要高吞吐量

 每次查询中大多数场景查询一个大表

 查询结果显著小于数据源，即数据有过滤或聚合



## 优点：

1）为了高效的使用CPU，数据不仅仅按列存储，同时还按向量进行处理；

2）数据压缩空间大，减少io；处理单查询高吞吐量每台服务器每秒最多数十亿行；

3）索引非B树结构，不需要满足最左原则；只要过滤条件在索引列中包含即可；即使在使用的数据不在索引中，由于各种并行处理机制ClickHouse全表扫描的速度也很快；

4）写入速度非常快，50-200M/s，对于大量的数据更新非常适用；

## 缺点

ClickHouse并非万能的，正因为ClickHouse处理速度快，所以也是需要为“快”付出代价。选择ClickHouse需要有下面注意以下几点： 

1）不支持事务，不支持真正的删除/更新；

2）不支持高并发，官方建议qps为100，可以通过修改配置文件增加连接数，但是在服务器足够好的情况下；

3）sql满足日常使用80%以上的语法，join写法比较特殊；最新版已支持类似sql的join，但性能不好；

4）**尽量做1000条以上批量的写入**，避免逐行insert或小批量的insert，update，delete操作，因为ClickHouse底层会不断的做异步的数据合并，会影响查询性能，这个在做实时数据写入的时候要尽量避开；

5）Clickhouse快是因为采用了并行处理机制，即使一个查询，也会用服务器一半的cpu去执行，所以ClickHouse不能支持高并发的使用场景，默认单查询使用cpu核数为服务器核数的一半，安装时会自动识别服务器核数，可以通过配置文件修改该参数；



