[TOC]



## 房间列表---男女区分逻辑-在线人数排行

```
//注意key不设置过期时间
//[男]正在直播的房间  以房间内人数排序 有序集合
const ROOM_LIST_RANK_MAN = 'roomListMan:sortedSet';

//[女]正在直播的房间  以房间内人数排序 有序集合
const ROOM_LIST_RANK_WOMAN = 'roomListWoman:sortedSet';



1.  房主开播时, 存储到Redis房间roomListMan:sortedSet     roomListWoman:sortedSet  人数默认1
2.  1号麦  默认男嘉宾     2号麦默认女嘉宾
3.  1号麦上麦/下麦时  roomListMan:sortedSet  这个房间的人数+1 / -1
4.  2号麦上麦/下麦时  roomListWoman:sortedSet 这个房间的人数+1 / -1
5.  普通用户进入/离开 房间时,roomListMan:sortedSet和roomListWoman:sortedSet  同时+1 / -1
6.  房间关闭房间时,从key中删除这个房间的信息 
```



## 房间列表---房间封面逻辑

```
1.  房主开播时, 存储红娘头像信息  昵称信息 到Redis房间room_face:roomId 注意key不设置过期时间
2.  1号麦  默认男嘉宾     2号麦默认女嘉宾
3.  1号麦上人时  记录男嘉宾的头像  昵称  年龄  城市
4.  2号麦上人时  记录男嘉宾的头像  昵称  年龄  城市
5.  1号[男嘉宾]麦下麦时   清空嘉宾麦的头像 昵称 年龄  城市数据  
    头像数据 从默认图片里  随机取一张
    
6.  2号[女嘉宾]麦下麦时   清空嘉宾麦的头像 昵称 年龄  城市数据  
    头像数据 从默认图片里  随机取一张

7.  房间关闭房间时,从key中删除这个房间的信息 



```



## 房间聊天室 与 融云聊天室

```
1.一个普通用户成为红娘时, 自动绑定一个房间id 且不可改变
2.红娘开启房间时  自动向融云创建聊天室  并 保活聊天室
3.红娘关闭房间时  自动向融云销毁聊天室
```



## 房间内 开闭麦逻辑V1

```
红娘可以关闭/开启 自己的麦[只关声音 不关画面]
红娘可以关闭/开启 嘉宾的麦[只关声音 不关画面]

嘉宾自己闭麦/开麦 在V2版本实现
红娘关闭的麦 嘉宾不能自己开启
嘉宾关闭自己的麦  红娘不能开启
```





## 房间流水

```
房间内礼物的赠送流水  与房间的收入流水  一一对应   但是存放在2个表里
```

