# 微服务6-服务层负载均衡的具体方案

## RPC请求-随机分配

```
$rpcServerUrl = [
	'192.168.0.1:9500',
	'192.168.0.2:9500'
];

使用rand()函数随机获取一个。
```



## RPC请求-轮询分配（相对均衡）

```
$rpcServerUrl = [
	'192.168.0.1:9500',
	'192.168.0.2:9500'
];
使用mt_rand()函数随机获取一个，概率接近50% 
```



## RPC请求-静态权重

> 适合场景  机器配置不一致

```
$rpcServerUrl = [
	'192.168.0.1:9500',
	'192.168.0.1:9500',
	'192.168.0.1:9500',
	'192.168.0.2:9500'
];
//注意 .1的机器出现了，3次， 所以获取到.1链接的概率是接近75%     最简单的方式实现了  权重静态分配
```



## RPC请求-动态权重

```
$rpcServerUrl = [
	'192.168.0.1:9500',
	'192.168.0.2:9500'
];
请求成功一次加1分，失败1次减10分，根据分值，进行权重的比例获取链接
分数低于一定阈值，则不再请求  并每次请求失败时，进行钉钉群报警
```





## RpcSever可用状态定时检测

> 每3秒请求一次rpcServer的某个rpc函数，如果正常返回  表示服务可用
>
> 如果返回异常 或者超时未响应  表示服务不可用
>
> 如果连续三次请求都异常， 通过代码修改配置文件，删除这台rpcServer的配置  进行下线。 并每次进行钉钉群报警
>
> 